# shared-memory
# Взаимодействие через разделяемую память в Docker

## Описание
Проект демонстрирует межпроцессное взаимодействие (**IPC**) с использованием **разделяемой памяти System V** в **Docker-контейнере**. В него входят две программы на **C**:

1. `writer.c` — создаёт сегмент разделяемой памяти, записывает в него "Hello world!" и выводит идентификатор памяти.
2. `reader.c` — получает идентификатор памяти из стандартного ввода, считывает из памяти сообщение, выводит его и удаляет сегмент.

Программы запускаются внутри **Docker-контейнера**, основанного на образе `gcc:11.3.0`.

## Структура репозитория
```
.
├── writer.c        # Запись данных в разделяемую память
├── reader.c        # Чтение данных из разделяемой памяти
├── Dockerfile      # Настройка Docker-образа
├── build.sh        # Скрипт сборки Docker-образа
├── run.sh          # Скрипт запуска программ
└── README.md       # Документация
```

## Требования
- **Docker** установлен на вашей системе

## Установка и использование

### 1. Сборка Docker-образа
Запустите `build.sh`, чтобы скомпилировать программы и создать образ Docker:
```sh
./build.sh
```
После выполнения создастся образ с именем `shm-example`.

### 2. Запуск программ
Выполните `run.sh`, чтобы запустить программы:
```sh
./run.sh
```
Скрипт выполняет:
1. Запуск `writer` в контейнере, который создаёт разделяемую память и выводит её идентификатор.
2. Захват идентификатора памяти.
3. Запуск `reader`, которому передаётся идентификатор памяти, после чего он читает и выводит сообщение.

### Пример вывода
```sh
Ключ разделяемой памяти: 65569
Hello world!
```

## Как это работает
1. **Процесс записи (`writer.c`)**:
   - Создаёт **разделяемую память** с помощью `shmget(IPC_PRIVATE, 1000, IPC_CREAT | 0666)`.
   - Записывает в неё "Hello world!".
   - Выводит идентификатор памяти.

2. **Процесс чтения (`reader.c`)**:
   - Считывает идентификатор памяти из стандартного ввода.
   - Подключается к сегменту памяти через `shmat()`.
   - Читает и выводит строку.
   - Отключается и **удаляет** сегмент памяти через `shmctl(IPC_RMID, NULL)`.

## Очистка
Так как контейнеры запускаются с флагом `--rm`, они удаляются автоматически после выполнения. Однако, если сегмент памяти не был удалён, его можно очистить вручную:
```sh
ipcs -m      # Просмотр сегментов разделяемой памяти
ipcrm -m ID  # Удаление сегмента по ID
```

## Дополнительные сведения
- Флаг `--ipc=host` позволяет контейнерам использовать общую память.
